{{define "order_items_form.html"}}
<div class="modal modal-modern">
    <div class="modal-backdrop" onclick="this.closest('.modal').remove()"></div>
    <div class="modal-dialog modal-dialog-modern">
        <div class="modal-header modal-header-modern">
            <h2 class="modal-title">{{.Title}}</h2>
            <button type="button" class="modal-close modal-close-modern" onclick="this.closest('.modal').remove()">
                <span>&times;</span>
            </button>
        </div>

        {{if .Error}}
        <div class="modal-error">
            <span class="error-icon">⚠️</span>
            <span>{{.Error}}</span>
        </div>
        {{end}}

        <form method="post" action="{{.Action}}" hx-post="{{.Action}}" hx-target="closest .modal" hx-swap="outerHTML" class="modal-form">
            <div id="menu-item-hidden">
                <input type="hidden" name="menu_item_id" value="{{.SelectedMenu}}">
            </div>

            <div class="form-group">
                <label for="modal-menu-query" class="form-label">
                    <span class="label-text">Menu item</span>
                    <span class="label-required">*</span>
                </label>
                <input id="modal-menu-query"
                       type="search"
                       name="menu_item_query"
                       value="{{.MenuQuery}}"
                       list="menu-item-options"
                       class="form-input"
                       placeholder="Type a shortcode or name"
                       hx-get="/orders/menu/match"
                       hx-trigger="keyup changed delay:250ms"
                       hx-target="#order-item-preview"
                       hx-include="[name=menu_item_query]"
                       autocomplete="off" />
                <datalist id="menu-item-options">
                    {{range .MenuItems}}
                    <option value="{{if .ShortCode}}{{.ShortCode}}{{else}}{{.Label}}{{end}}" label="{{.Label}}"></option>
                    {{end}}
                </datalist>
                <span class="form-hint">Suggestions appear as you type; press Enter to accept.</span>
            </div>

            <div class="form-row form-row-split">
                <div class="form-group">
                    <label for="modal-quantity" class="form-label">Quantity</label>
                    <input id="modal-quantity" type="number" name="quantity" min="1" value="{{if .Quantity}}{{.Quantity}}{{else}}1{{end}}" class="form-input" required>
                </div>
            </div>

            <div id="order-item-preview">
                {{template "order_item_preview.html" .}}
            </div>

            <div class="form-group">
                <label for="modal-group" class="form-label">Bill group</label>
                <select id="modal-group" name="group_id" class="form-select">
                    <option value="" {{if eq .GroupID ""}}selected{{end}}>No group</option>
                    {{range .Groups}}
                    <option value="{{.ID}}" {{if eq $.GroupID .ID}}selected{{end}}>{{.Name}}</option>
                    {{end}}
                </select>
                <span class="form-hint">Need a split?
                    <button type="button" class="btn-inline" hx-get="/orders/{{.OrderID}}/groups/new" hx-target="#modal-root" hx-swap="innerHTML">Create a group</button>
                </span>
            </div>

            <div class="form-group">
                <label for="modal-notes" class="form-label">Notes</label>
                <textarea id="modal-notes" name="notes" rows="3" class="form-input" placeholder="Add notes or special instructions.">{{.Notes}}</textarea>
            </div>

            <div class="modal-actions modal-actions-modern">
                <button type="button" class="btn-modal btn-modal-cancel" onclick="this.closest('.modal').remove()">
                    Cancel
                </button>
                <button type="submit" class="btn-modal btn-modal-primary">
                    <span class="btn-icon">+</span> Add Item
                </button>
            </div>
        </form>
    </div>
</div>
{{end}}
